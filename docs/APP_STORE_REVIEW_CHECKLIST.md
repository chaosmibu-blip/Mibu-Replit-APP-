# App Store 審查自檢清單

## 審查環境資訊
- **App 名稱**: Mibu
- **Bundle ID**: com.chaos.mibu
- **版本**: 1.0.0
- **Build Number**: 7
- **目標設備**: iPhone（iPad 以 2x 縮放模式運行）

---

## 審查備註（提交時填入 App Store Connect）

```
審查備註 / Reviewer Notes:

1. 本 App 設計為 iPhone 專用。在 iPad 上會以 2x 縮放模式運行。

2. 「開始扭蛋」功能使用 AI 生成行程，處理時間約需 1-2 分鐘，請耐心等候。畫面上會顯示進度提示和預估時間。

3. 測試方式：請使用 Apple 登入進行測試，無需測試帳號。

---

1. This app is designed for iPhone. It runs in 2x compatibility mode on iPad.

2. The "Start Gacha" feature uses AI to generate itineraries and may take 1-2 minutes. Progress indicators and estimated time are displayed on screen.

3. Testing: Please use Apple Sign In to test. No test account required.
```

---

## 審查流程模擬

### 階段 1：安裝與啟動

| 測試項目 | 預期結果 | iPhone 測試 | iPad 2x 測試 |
|---------|---------|-------------|--------------|
| App 可正常安裝 | 安裝成功 | ⬜ | ⬜ |
| App 可正常啟動 | 顯示 Splash 後進入登入頁 | ⬜ | ⬜ |
| Splash 畫面正常顯示 | 品牌色背景 + Logo | ⬜ | ⬜ |
| 無啟動 crash | App 穩定運行 | ⬜ | ⬜ |

### 階段 2：登入流程

| 測試項目 | 預期結果 | iPhone 測試 | iPad 2x 測試 |
|---------|---------|-------------|--------------|
| 訪客登入 | 成功進入主頁 | ⬜ | ⬜ |
| Apple 登入 | OAuth 流程正常，成功登入 | ⬜ | ⬜ |
| 登入後導航 | 正確導向旅客首頁 | ⬜ | ⬜ |
| 語言切換 | 可切換繁中/英文/日文/韓文 | ⬜ | ⬜ |

### 階段 3：主要功能 - 行程扭蛋

| 測試項目 | 預期結果 | iPhone 測試 | iPad 2x 測試 |
|---------|---------|-------------|--------------|
| 扭蛋頁面載入 | 顯示國家選擇器 | ⬜ | ⬜ |
| 選擇國家 | Modal 正常開啟，顯示「台灣」 | ⬜ | ⬜ |
| 選擇城市/地區 | Modal 正常開啟，顯示地區列表 | ⬜ | ⬜ |
| 調整抽取張數 | Slider 可正常操作 | ⬜ | ⬜ |
| 點擊「開始扭蛋」| 顯示載入畫面 | ⬜ | ⬜ |
| 載入畫面資訊 | 顯示「預計需要 1-2 分鐘」 | ⬜ | ⬜ |
| 載入畫面動畫 | 貓腳印動畫正常播放 | ⬜ | ⬜ |
| 載入提示輪播 | 每 3 秒切換不同提示文字 | ⬜ | ⬜ |
| 等待 1-2 分鐘 | AI 完成生成，進入結果頁 | ⬜ | ⬜ |
| 結果頁顯示 | 顯示行程卡片列表 | ⬜ | ⬜ |
| 取消按鈕 | 可取消載入，返回扭蛋頁 | ⬜ | ⬜ |

### 階段 4：圖鑑功能

| 測試項目 | 預期結果 | iPhone 測試 | iPad 2x 測試 |
|---------|---------|-------------|--------------|
| 圖鑑頁面載入 | 正常顯示收藏列表 | ⬜ | ⬜ |
| 空狀態顯示 | 若無收藏，顯示提示文字 | ⬜ | ⬜ |
| 景點卡片點擊 | 可查看詳情 | ⬜ | ⬜ |

### 階段 5：設定頁面

| 測試項目 | 預期結果 | iPhone 測試 | iPad 2x 測試 |
|---------|---------|-------------|--------------|
| 設定頁載入 | 顯示用戶資訊和選項 | ⬜ | ⬜ |
| 語言設定 | 可切換語言 | ⬜ | ⬜ |
| 登出功能 | 成功登出，返回登入頁 | ⬜ | ⬜ |
| 刪除帳號 | 顯示確認對話框 | ⬜ | ⬜ |

### 階段 6：UI/UX 檢查

| 測試項目 | 預期結果 | iPhone 測試 | iPad 2x 測試 |
|---------|---------|-------------|--------------|
| 安全區域 | 內容不被 notch/home bar 遮擋 | ⬜ | ⬜ |
| 文字可讀性 | 所有文字清晰可讀 | ⬜ | ⬜ |
| 按鈕點擊區域 | 觸控目標足夠大 (44x44pt) | ⬜ | ⬜ |
| 鍵盤處理 | 輸入框不被鍵盤遮擋 | ⬜ | ⬜ |
| 深色/淺色模式 | 兩種模式都正常顯示 | ⬜ | ⬜ |
| 橫向旋轉 | 鎖定直向，不支援橫向 | ⬜ | ⬜ |

### 階段 7：錯誤處理

| 測試項目 | 預期結果 | iPhone 測試 | iPad 2x 測試 |
|---------|---------|-------------|--------------|
| 網路斷開 | 顯示友善錯誤提示 | ⬜ | ⬜ |
| API 逾時 | 不會無限載入，有錯誤處理 | ⬜ | ⬜ |
| 無效 Token | 自動導向登入頁 | ⬜ | ⬜ |

---

## 自我審查結果（2026-01-08）

### 發現的問題與修復狀態

| 問題類型 | 描述 | 狀態 | 修復說明 |
|---------|------|------|---------|
| 多語系 | 載入畫面「取消」按鈕只顯示中文 | ✅ 已修復 | 新增英/日/韓語支援 |
| API 超時 | API 呼叫無 timeout 機制 | ⚠️ 待觀察 | AI 生成本身需 1-2 分鐘，已在 UI 中告知用戶 |
| 錯誤處理 | API 錯誤有處理但可優化 | ✅ 正常 | handleGacha 已處理各種錯誤碼 |
| 取消功能 | 載入畫面取消按鈕 | ✅ 正常 | onCancel 已正確傳遞並處理 |
| 安全區域 | SafeAreaView 使用 | ✅ 正常 | LoadingAdScreen 已使用 SafeAreaView |
| OAuth 登入 | Google/Apple 登入流程 | ✅ 正常 | 使用環境變數統一 URL |
| 訪客登入 | 無需帳號即可使用 | ✅ 正常 | handleGuestLogin 正常運作 |

### 關鍵流程檢查

#### 1. 登入流程 ✅
- [x] 訪客登入可用
- [x] Apple 登入 OAuth 流程完整
- [x] 錯誤碼處理（NO_MERCHANT_DATA、NO_SPECIALIST_DATA 等）
- [x] Token 儲存與讀取正常

#### 2. 扭蛋流程 ✅
- [x] 國家選擇器正常載入
- [x] 地區選擇器正常載入
- [x] 抽取張數滑桿正常
- [x] 載入畫面顯示預估時間（1-2 分鐘）
- [x] 載入提示每 3 秒輪播
- [x] 取消按鈕可用且多語系
- [x] 錯誤處理完整（DAILY_LIMIT_EXCEEDED、EXCEEDS_REMAINING_QUOTA 等）
- [x] 結果頁正常顯示

#### 3. UI/UX 檢查 ✅
- [x] 使用 React Native 原生元件（View, Text, TouchableOpacity）
- [x] 多語系支援（zh-TW, en, ja, ko）
- [x] SafeAreaView 正確使用
- [x] Modal 使用正確

---

## 常見拒絕原因與對策

### Guideline 2.1 - Performance - App Completeness
**問題**: App 持續載入或功能無法完成
**對策**: 
- ✅ 已加入預估等待時間提示（1-2 分鐘）
- ✅ 已加入輪播提示文字
- ✅ 已加入取消按鈕
- ✅ 在審查備註中說明 AI 處理需要較長時間

### Guideline 2.3 - Performance - Accurate Metadata
**問題**: App 描述與實際功能不符
**對策**: 確保 App Store 描述準確反映 App 功能

### Guideline 4.0 - Design - iPad Compatibility
**問題**: iPad 上 UI 顯示異常
**對策**: 
- ✅ 已設定 supportsTablet: false
- ⚠️ 需確保 App 在 iPad 2x 模式下仍可正常使用

---

## 提交前最終檢查

- [ ] 已在 iPhone 實機測試所有功能
- [ ] 已在 iPad 2x 模式測試所有功能
- [ ] 確認連接正式環境 API
- [ ] 確認 buildNumber 已更新
- [ ] 填寫審查備註
- [ ] 準備測試帳號資訊
- [ ] 確認隱私權政策連結有效
- [ ] 確認 App 圖示和截圖正確

---

## 歷史審查記錄

### 第一次提交 (2026-01-XX)
- **結果**: 拒絕
- **原因**: iPad 支援問題
- **修復**: 設定 supportsTablet: false

### 第二次提交 (2026-01-08)
- **結果**: 拒絕
- **原因**: Guideline 2.1 - 點擊「開始扭蛋」後持續載入
- **審查設備**: iPad Air 11-inch (M3), iPadOS 26.1
- **修復**: 
  - 加入預估等待時間提示
  - 加入輪播提示文字
  - 加入取消按鈕
  - 準備審查備註說明 AI 處理時間

### 第三次提交 (待進行)
- **待辦**: 
  - 在 iPad 2x 模式下完整測試
  - 提交時填入審查備註
