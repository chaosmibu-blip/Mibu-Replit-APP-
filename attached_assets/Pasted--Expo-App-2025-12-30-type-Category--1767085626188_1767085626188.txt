çµ¦å‰ç«¯ï¼ˆExpo Appï¼‰çš„åŒæ­¥æ›´æ–°æŒ‡ä»¤
è«‹å°‡ä»¥ä¸‹å…§å®¹è¤‡è£½è²¼çµ¦å‰ç«¯é–‹ç™¼ï¼š

ğŸ”´ é‡å¤§è®Šæ›´ï¼šé¡åˆ¥å®šç¾©æ›´æ–°ï¼ˆ2025-12-30ï¼‰
èˆŠç‰ˆï¼ˆå…«å¤§é¡ï¼‰ï¼š

type Category = 'ç¾é£Ÿ' | 'ä½å®¿' | 'æ™¯é»' | 'è³¼ç‰©' | 'å¨›æ¨‚è¨­æ–½' | 'ç”Ÿæ…‹æ–‡åŒ–æ•™è‚²' | 'éŠç¨‹é«”é©—' | 'æ´»å‹•';
æ–°ç‰ˆï¼ˆä¸ƒå¤§é¡ï¼‰ï¼š

// ã€Œæ´»å‹•ã€é¡åˆ¥å·²ç§»é™¤ï¼Œç›¸é—œæ™¯é»å·²é‡æ–°åˆ†é…åˆ°å…¶ä»–é¡åˆ¥
type MibuCategory = 'ç¾é£Ÿ' | 'ä½å®¿' | 'æ™¯é»' | 'è³¼ç‰©' | 'å¨›æ¨‚è¨­æ–½' | 'ç”Ÿæ…‹æ–‡åŒ–æ•™è‚²' | 'éŠç¨‹é«”é©—';
å½±éŸ¿ç¯„åœï¼š

æ‰€æœ‰ API å›æ‡‰ä¸­çš„ category æ¬„ä½éƒ½æ”¹ç”¨ä¸ƒå¤§é¡
å‰ç«¯å¦‚æœ‰ æ´»å‹• çš„ UI é¡¯ç¤ºé‚è¼¯ï¼Œéœ€ç§»é™¤æˆ–æ”¹ç‚º fallback
âš ï¸ æ‡‰å»¢æ£„çš„ APIï¼ˆè«‹å‹¿ä½¿ç”¨ï¼‰
å»¢æ£„ API	æ›¿ä»£ API	åŸå› 
POST /api/generate-itinerary	POST /api/gacha/itinerary/v3	Legacy ç«¯é»ï¼Œå›æ‡‰æ ¼å¼ä¸ä¸€è‡´
POST /api/gacha/itinerary	POST /api/gacha/itinerary/v3	V1 èˆŠç‰ˆï¼Œç„¡æ¯æ—¥é¡åº¦æ§åˆ¶
POST /api/gacha/pull	POST /api/gacha/pull/v3	V1 èˆŠç‰ˆ
POST /api/gacha/pull/v2	POST /api/gacha/pull/v3	V2 èˆŠç‰ˆ
GET /api/gacha/pool/:city/:district	GET /api/gacha/pool	éæ–¼ç´°åˆ†ï¼Œæ”¹ç”¨ regionId
âœ… æ‰­è›‹æ¨¡çµ„ - æ‡‰ä½¿ç”¨çš„ APIï¼ˆV3ï¼‰
1. POST /api/gacha/itinerary/v3 â­ ä¸»è¦ç«¯é»
// Request
{
  regionId?: number;      // ç¸£å¸‚ IDï¼ˆå„ªå…ˆï¼‰
  countryId?: number;     // åœ‹å®¶ IDï¼ˆè‹¥æœªæä¾› regionIdï¼‰
  city?: string;          // åŸå¸‚åç¨±ï¼ˆLegacyï¼‰
  district?: string;      // å€åŸŸåç¨±ï¼ˆå¯é¸ï¼‰
  itemCount?: number;     // 1-15ï¼ˆé è¨­ 7ï¼‰
  pace?: 'relaxed' | 'moderate' | 'packed';
  language?: string;
}
// Response
{
  success: boolean;
  itinerary: Array<{
    timeSlot: 'breakfast' | 'morning' | 'lunch' | 'afternoon' | 'dinner' | 'evening';
    place: {
      id: number;
      placeName: string;
      category: MibuCategory;  // âš ï¸ ä¸ƒå¤§é¡
      subcategory: string | null;
      description: string | null;
      address: string | null;
      rating: number | null;
      locationLat: number | null;
      locationLng: number | null;
      googlePlaceId: string | null;
    };
    couponWon?: {
      id: number;
      title: string;
      code: string;
      terms: string | null;
    } | null;
  }>;
  couponsWon: Array<{...}>;
  meta: {
    city: string;
    district: string | null;
    dailyLimit: number;        // 36
    dailyPullCount: number;    // ä»Šæ—¥å·²æŠ½
    remainingQuota: number;    // å‰©é¤˜é¡åº¦
    categoryDistribution?: Record<MibuCategory, number>;
    sortingMethod?: 'coordinate' | 'ai_reordered';
    aiReorderResult?: 'reordered' | 'no_change' | 'no_numbers' | 'error';
  };
  themeIntro?: string;
}
2. POST /api/gacha/pull/v3 å–®ä¸€æŠ½å¡
éœ€è¦ç™»å…¥ï¼ˆBearer Tokenï¼‰

3. GET /api/gacha/pool çæ± é è¦½
// Query: ?regionId=1 æˆ– ?city=å°åŒ—å¸‚
{
  success: boolean;
  pool: {
    city: string;
    jackpots: Array<{
      id: number;
      placeName: string;
      category: MibuCategory;
      subCategory: string;
      rating: string | null;
    }>;
    totalInPool: number;
    jackpotCount: number;
  };
}
4. GET /api/gacha/prize-pool é«˜ç¨€æœ‰åº¦å„ªæƒ åˆ¸çæ± 
ğŸ“ å‰ç«¯ Action Items
æ›´æ–° TypeScript é¡å‹å®šç¾©
// types/category.ts
export const MIBU_CATEGORIES = ['ç¾é£Ÿ', 'ä½å®¿', 'æ™¯é»', 'è³¼ç‰©', 'å¨›æ¨‚è¨­æ–½', 'ç”Ÿæ…‹æ–‡åŒ–æ•™è‚²', 'éŠç¨‹é«”é©—'] as const;
export type MibuCategory = typeof MIBU_CATEGORIES[number];
ç§»é™¤å°å»¢æ£„ API çš„èª¿ç”¨
æœå°‹ /api/generate-itinerary â†’ æ”¹ç”¨ /api/gacha/itinerary/v3
æœå°‹ /api/gacha/pull (ä¸å« v3) â†’ æ”¹ç”¨ /api/gacha/pull/v3
æœå°‹ /api/gacha/itinerary (ä¸å« v3) â†’ æ”¹ç”¨ /api/gacha/itinerary/v3
ç§»é™¤ã€Œæ´»å‹•ã€é¡åˆ¥ç›¸é—œ UI
å¦‚æœ‰ category === 'æ´»å‹•' çš„åˆ¤æ–·ï¼Œæ”¹ç‚º fallback è™•ç†
å¦‚æœ‰ã€Œæ´»å‹•ã€çš„ç¯©é¸é¸é …ï¼Œè«‹ç§»é™¤
ç¢ºèªæ¯æ—¥é¡åº¦é¡¯ç¤º
meta.dailyLimit = 36ï¼ˆæ¯æ—¥ä¸Šé™ï¼‰
meta.dailyPullCount = ä»Šæ—¥å·²æŠ½å¼µæ•¸
meta.remainingQuota = å‰©é¤˜å¯æŠ½å¼µæ•¸
