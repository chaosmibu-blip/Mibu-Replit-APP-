å®Œæ•´ API ç«¯é»æ¸…å–®
Base URL: https://gacha-travel--s8869420.replit.app

èªè­‰æ–¹å¼
æ‰€æœ‰éœ€è¦èªè­‰çš„ API å¿…é ˆåœ¨ Header åŠ ä¸Šï¼š

Authorization: Bearer <token>
Content-Type: application/json
ğŸ” èªè­‰ (Auth)
ç«¯é»	æ–¹æ³•	èªè­‰	èªªæ˜
/api/auth/apple	POST	âŒ	Apple ç™»å…¥
/api/auth/login	POST	âŒ	Email ç™»å…¥
/api/auth/register	POST	âŒ	æ—…å®¢è¨»å†Š
/api/auth/register/merchant	POST	âŒ	å•†å®¶è¨»å†Š
/api/auth/register/specialist	POST	âŒ	å°ˆå“¡è¨»å†Š
/api/auth/user	GET	âœ…	å–å¾—ç•¶å‰ç”¨æˆ¶
/api/auth/logout	POST	âœ…	ç™»å‡º
/api/user/account	DELETE	âœ…	åˆªé™¤å¸³è™Ÿ
POST /api/auth/apple (Apple ç™»å…¥)
// Request
{
  identityToken: string;  // å¿…å¡«
  user: string;           // å¿…å¡«
  portal?: "traveler" | null;
  email?: string | null;
  fullName?: { givenName?: string | null; familyName?: string | null } | null;
}
// Response (æˆåŠŸ)
{
  success: true,
  token: string,          // JWT (7å¤©æœ‰æ•ˆ)
  user: {
    id: string,
    email: string,
    name: string,
    role: string,
    isApproved: boolean,
    isSuperAdmin: boolean
  }
}
GET /api/auth/user (å–å¾—ç•¶å‰ç”¨æˆ¶)
// Response
{
  id: string,
  email: string,
  firstName: string | null,
  lastName: string | null,
  role: "traveler" | "merchant" | "specialist" | "admin",
  profileImageUrl: string | null,
  activeRole: string,
  accessibleRoles: string[]
}
ğŸ° æ‰­è›‹ (Gacha)
ç«¯é»	æ–¹æ³•	èªè­‰	èªªæ˜
/api/gacha/itinerary/v3	POST	âšª é¸å¡«	ç”Ÿæˆè¡Œç¨‹ (ä¸»è¦ API)
/api/generate-itinerary	POST	âŒ	ç”Ÿæˆè¡Œç¨‹ (è¨ªå®¢æ¨¡å¼)
/api/gacha/pool	GET	âŒ	å–å¾—çæ± é è¦½
POST /api/gacha/itinerary/v3 (ç”Ÿæˆè¡Œç¨‹)
// Request
{
  regionId?: number;      // ç¸£å¸‚ ID (å„ªå…ˆä½¿ç”¨)
  countryId?: number;     // åœ‹å®¶ ID
  itemCount?: number;     // æ™¯é»æ•¸é‡ 1-15 (é è¨­ 7)
  pace?: "relaxed" | "moderate" | "packed";
  language?: string;
}
// Response
{
  success: boolean,
  itinerary: Array<{
    timeSlot: string,
    place: {
      id: number,
      placeName: string,
      category: string,
      subcategory: string | null,
      description: string | null,
      address: string | null,
      rating: number | null,
      locationLat: number | null,
      locationLng: number | null
    },
    couponWon?: { id, title, code, terms } | null
  }>,
  meta: {
    city: string,
    district: string | null,
    dailyLimit: number,
    dailyPullCount: number,
    remainingQuota: number
  },
  themeIntro?: string
}
ğŸ“¦ æ”¶è— (Collection)
ç«¯é»	æ–¹æ³•	èªè­‰	èªªæ˜
/api/collections	GET	âœ…	å–å¾—æ”¶è—åˆ—è¡¨
/api/collection/with-promo	GET	âœ…	å–å¾—æ”¶è— (å«å„ªæƒ ç‹€æ…‹)
/api/collection/auto-save	POST	âœ…	è‡ªå‹•å„²å­˜æ”¶è—
ğŸ é“å…·ç®± (Inventory)
ç«¯é»	æ–¹æ³•	èªè­‰	èªªæ˜
/api/inventory	GET	âœ…	å–å¾—é“å…·ç®±
/api/inventory/:id	GET	âœ…	å–å¾—å–®ä¸€é“å…·
/api/inventory/:id/read	POST	âœ…	æ¨™è¨˜å·²è®€
/api/inventory/:id/redeem	POST	âœ…	å…Œæ›å„ªæƒ åˆ¸
/api/inventory/:id	DELETE	âœ…	åˆªé™¤é“å…·
ğŸ”” é€šçŸ¥ (Notifications)
ç«¯é»	æ–¹æ³•	èªè­‰	èªªæ˜
/api/notifications	GET	âœ…	å–å¾—æœªè®€æ•¸é‡
/api/notifications/:type/seen	POST	âœ…	æ¨™è¨˜å·²è®€
GET /api/notifications
// Response
{
  unread: {
    collection: number,
    itembox: number,
    announcement: number
  },
  total: number
}
ğŸ“ åœ°ç†è³‡è¨Š (Locations)
ç«¯é»	æ–¹æ³•	èªè­‰	èªªæ˜
/api/locations/countries	GET	âŒ	å–å¾—åœ‹å®¶åˆ—è¡¨
/api/locations/regions/:countryId	GET	âŒ	å–å¾—ç¸£å¸‚åˆ—è¡¨
/api/locations/districts/:regionId	GET	âŒ	å–å¾—é„‰é®å€åˆ—è¡¨
ğŸ“¢ å…¬å‘Š (Announcements)
ç«¯é»	æ–¹æ³•	èªè­‰	èªªæ˜
/api/announcements	GET	âŒ	å–å¾—å…¬å‘Šåˆ—è¡¨
ğŸ†˜ SOS å®‰å…¨ä¸­å¿ƒ
ç«¯é»	æ–¹æ³•	èªè­‰	èªªæ˜
/api/sos/eligibility	GET	âœ…	æª¢æŸ¥ SOS è³‡æ ¼
/api/sos/alert	POST	âœ…	ç™¼é€ SOS è­¦å ±
/api/sos/alerts	GET	âœ…	å–å¾—è­¦å ±åˆ—è¡¨
/api/sos/trigger	POST	âŒ	Webhook è§¸ç™¼ SOS
/api/user/sos-link	GET	âœ…	å–å¾— SOS é€£çµ
ğŸ“± å»£å‘Š (Ads)
ç«¯é»	æ–¹æ³•	èªè­‰	èªªæ˜
/api/ads/placements	GET	âŒ	å–å¾—å»£å‘Šè¨­å®š
ğŸ‘¤ å€‹äººè³‡æ–™ (Profile)
ç«¯é»	æ–¹æ³•	èªè­‰	èªªæ˜
/api/profile	GET	âœ…	å–å¾—å€‹äººè³‡æ–™
/api/profile	PATCH	âœ…	æ›´æ–°å€‹äººè³‡æ–™
/api/location/update	POST	âœ…	æ›´æ–°ä½ç½®
/api/location/me	GET	âœ…	å–å¾—æˆ‘çš„ä½ç½®
çµ±ä¸€éŒ¯èª¤æ ¼å¼
{
  errorCode: string;  // å¦‚ "E1001"
  message: string;    // éŒ¯èª¤è¨Šæ¯
}
å¸¸è¦‹éŒ¯èª¤ç¢¼
ä»£ç¢¼	èªªæ˜
E1001	è«‹å…ˆç™»å…¥
E1002	ç™»å…¥å·²éæœŸ
E1003	ç„¡æ•ˆçš„ç™»å…¥æ†‘è­‰
E1004	é›»å­éƒµä»¶æˆ–å¯†ç¢¼éŒ¯èª¤
E5001	è¼¸å…¥è³‡æ–™æ ¼å¼éŒ¯èª¤
E9001	ä¼ºæœå™¨éŒ¯èª¤
å®Œæ•´æ–‡ä»¶è«‹æŸ¥çœ‹ï¼šdocs/API_CONTRACT.md