Expo 前端同步指令 (v1.1.0)
一、推播通知功能
安裝套件：

npx expo install expo-notifications expo-constants expo-device
實作要點：

在 App 啟動時註冊推播權限
取得 Expo Push Token
登入後呼叫 POST /api/user/push-token 註冊 token
登出時呼叫 DELETE /api/user/push-token 移除 token
程式碼範例：

import * as Notifications from 'expo-notifications';
import Constants from 'expo-constants';
async function registerForPushNotifications(authToken: string) {
  const { status: existingStatus } = await Notifications.getPermissionsAsync();
  let finalStatus = existingStatus;
  
  if (existingStatus !== 'granted') {
    const { status } = await Notifications.requestPermissionsAsync();
    finalStatus = status;
  }
  
  if (finalStatus !== 'granted') return null;
  
  const token = await Notifications.getExpoPushTokenAsync({
    projectId: Constants.expoConfig?.extra?.eas?.projectId,
  });
  
  // 註冊到後端
  await fetch('https://gacha-travel--s8869420.replit.app/api/user/push-token', {
    method: 'POST',
    headers: {
      'Authorization': `Bearer ${authToken}`,
      'Content-Type': 'application/json',
    },
    body: JSON.stringify({ token: token.data }),
  });
  
  return token.data;
}
// 登出時移除
async function removePushToken(authToken: string) {
  await fetch('https://gacha-travel--s8869420.replit.app/api/user/push-token', {
    method: 'DELETE',
    headers: { 'Authorization': `Bearer ${authToken}` },
  });
}
二、照片上傳功能
安裝套件：

npx expo install expo-image-picker
上傳流程 (三步驟)：

POST /api/uploads/request-url → 取得 presigned URL
PUT <uploadURL> → 直接上傳到 GCS
使用回傳的 objectPath 存到資料庫
程式碼範例：

import * as ImagePicker from 'expo-image-picker';
async function uploadPhoto() {
  // 1. 選擇圖片
  const result = await ImagePicker.launchImageLibraryAsync({
    mediaTypes: ImagePicker.MediaTypeOptions.Images,
    allowsEditing: true,
    quality: 0.8,
  });
  
  if (result.canceled) return null;
  const asset = result.assets[0];
  const fileName = asset.uri.split('/').pop() || 'photo.jpg';
  
  // 2. 取得 presigned URL
  const urlResponse = await fetch(
    'https://gacha-travel--s8869420.replit.app/api/uploads/request-url',
    {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({
        name: fileName,
        size: asset.fileSize || 0,
        contentType: asset.mimeType || 'image/jpeg',
      }),
    }
  );
  const { uploadURL, objectPath } = await urlResponse.json();
  
  // 3. 上傳到 GCS
  const response = await fetch(asset.uri);
  const blob = await response.blob();
  
  await fetch(uploadURL, {
    method: 'PUT',
    body: blob,
    headers: { 'Content-Type': asset.mimeType || 'image/jpeg' },
  });
  
  // 回傳 objectPath 給後端存儲
  return objectPath;
}
存取已上傳檔案：

GET https://gacha-travel--s8869420.replit.app/objects/<objectPath>
三、新增 TypeScript 類型 (types/api.ts)
// 推播通知回應
export interface PushTokenResponse {
  status: 'ok';
  message: string;
}
// 檔案上傳回應
export interface UploadUrlResponse {
  uploadURL: string;
  objectPath: string;
  metadata: {
    name: string;
    size: number;
    contentType: string;
  };
}
四、整合建議
功能	時機
註冊 Push Token	用戶登入成功後
移除 Push Token	用戶登出時
照片上傳	用戶個人資料、評論照片、商家資料等