=== 前端同步指令 ===
【後端更新摘要】
實作嚴格的登入權限矩陣，根據用戶角色和選擇的入口驗證登入權限。不符合權限的登入會被拒絕並返回對應的錯誤代碼。
【登入權限矩陣】
| 用戶類型 | 旅客入口 | 商家入口 | 專員入口 | 管理入口 |
|---------|---------|---------|---------|---------|
| 一般用戶 (traveler) | ✅ 成功 | ❌ NO_MERCHANT_DATA | ❌ NO_SPECIALIST_DATA | ❌ PERMISSION_DENIED |
| 商家帳號 (merchant) | ❌ WRONG_PORTAL | ✅ 成功 | ❌ PERMISSION_DENIED | ❌ PERMISSION_DENIED |
| 專員帳號 (specialist) | ❌ WRONG_PORTAL | ❌ PERMISSION_DENIED | ✅ 成功 | ❌ PERMISSION_DENIED |
| 超級管理員 | ✅ God Mode | ✅ God Mode | ✅ God Mode | ✅ 成功 |
【錯誤代碼說明】
- `NO_MERCHANT_DATA` - 您尚未註冊為商家，請先申請商家帳號
- `NO_SPECIALIST_DATA` - 您尚未註冊為專員，請先申請專員帳號
- `WRONG_PORTAL` - 請切換至正確的入口登入
- `PERMISSION_DENIED` - 權限不符，無法進入此後台
【API 變更】
- 登入 URL 支援 `portal` 參數：`/api/login?portal=merchant&redirect_uri=mibu://callback`
- 登入失敗時回傳：`mibu://callback?error={錯誤代碼}&message={錯誤訊息}`
- 登入成功時回傳：`mibu://callback?token={JWT}`
【前端需要的改動】
1. 登入頁面：在呼叫登入前，加入 `portal` 參數指定入口類型
2. 處理登入回調：解析 URL 中的 `error` 和 `message` 參數
3. 錯誤提示：根據錯誤代碼顯示對應的引導訊息
【登入呼叫範例】
```javascript
// 1. 旅客入口登入
const loginUrl = 'https://gacha-travel--s8869420.replit.app/api/login?portal=traveler&redirect_uri=mibu://callback';
Linking.openURL(loginUrl);
// 2. 商家入口登入
const loginUrl = 'https://gacha-travel--s8869420.replit.app/api/login?portal=merchant&redirect_uri=mibu://callback';
Linking.openURL(loginUrl);
// 3. 專員入口登入
const loginUrl = 'https://gacha-travel--s8869420.replit.app/api/login?portal=specialist&redirect_uri=mibu://callback';
Linking.openURL(loginUrl);
// 4. 管理入口登入
const loginUrl = 'https://gacha-travel--s8869420.replit.app/api/login?portal=admin&redirect_uri=mibu://callback';
Linking.openURL(loginUrl);
【處理登入回調】

// 解析 deep link 回調
const handleDeepLink = (url) => {
  const parsed = new URL(url);
  const token = parsed.searchParams.get('token');
  const error = parsed.searchParams.get('error');
  const message = parsed.searchParams.get('message');
  
  if (error) {
    // 登入失敗 - 顯示錯誤訊息
    switch (error) {
      case 'NO_MERCHANT_DATA':
        // 導向商家註冊頁面
        Alert.alert('尚未註冊商家', message || '請先申請商家帳號');
        navigation.navigate('MerchantRegistration');
        break;
      case 'NO_SPECIALIST_DATA':
        // 導向專員申請頁面
        Alert.alert('尚未註冊專員', message || '請先申請專員帳號');
        navigation.navigate('SpecialistApplication');
        break;
      case 'WRONG_PORTAL':
        // 提示切換入口
        Alert.alert('入口錯誤', message || '請切換至正確的入口登入');
        break;
      case 'PERMISSION_DENIED':
        // 權限不足
        Alert.alert('權限不足', message || '您沒有權限存取此功能');
        break;
      default:
        Alert.alert('登入失敗', message || '請稍後再試');
    }
    return;
  }
  
  if (token) {
    // 登入成功 - 儲存 token 並取得用戶資料
    await SecureStore.setItemAsync('token', token);
    const userInfo = await fetchUserInfo(token);
    // userInfo.activeRole 決定顯示哪個介面
    navigateToRoleInterface(userInfo.activeRole);
  }
};
【取得用戶資料後判斷介面】

// GET /api/auth/user
const response = await fetch('https://gacha-travel--s8869420.replit.app/api/auth/user', {
  headers: { 'Authorization': `Bearer ${token}` }
});
const user = await response.json();
// 根據 activeRole 顯示對應介面
switch (user.activeRole) {
  case 'traveler':
    navigation.navigate('TravelerHome'); // 地圖/轉蛋
    break;
  case 'merchant':
    navigation.navigate('MerchantDashboard'); // 商家後台
    break;
  case 'specialist':
    navigation.navigate('SpecialistDashboard'); // 專員後台
    break;
  case 'admin':
    navigation.navigate('AdminDashboard'); // 管理後台
    break;
}
【回傳資料格式】

// 登入成功時 URL 參數
{ token: string }
// 登入失敗時 URL 參數
{ 
  error: 'NO_MERCHANT_DATA' | 'NO_SPECIALIST_DATA' | 'WRONG_PORTAL' | 'PERMISSION_DENIED' | 'auth_failed',
  message: string  // URL encoded 中文訊息
}
// GET /api/auth/user 回傳
{
  id: string,
  email: string,
  role: 'traveler' | 'merchant' | 'specialist' | 'admin',  // 資料庫角色
  activeRole: 'traveler' | 'merchant' | 'specialist' | 'admin',  // 當前使用的角色
  isSuperAdmin: boolean,
  accessibleRoles: string[]  // 超級管理員專用：可切換的角色列表
}