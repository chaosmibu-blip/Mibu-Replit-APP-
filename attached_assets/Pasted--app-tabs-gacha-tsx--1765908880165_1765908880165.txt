å¥½çš„ï¼Œåç«¯æ‰­è›‹ç³»ç»Ÿå·²æ›´æ–°ã€‚ç°åœ¨æˆ‘ä»¬éœ€è¦æ”¹é€ å‰ç«¯çš„ã€æ‰­è›‹ã€‘é¡µé¢æ¥é…åˆå®ƒã€‚

è¯·æ‰“å¼€ `app/(tabs)/gacha.tsx` (æˆ–è€…æ‰­è›‹é¡µé¢çš„å¯¹åº”æ¡£æ¡ˆ)ï¼Œå¹¶ä½¿ç”¨ä»¥ä¸‹ç¨‹å¼ç **å®Œæ•´åœ°å–ä»£**æ¡£æ¡ˆä¸­ç°æœ‰çš„å…¨éƒ¨å†…å®¹ã€‚

è¿™ä¸ªæ–°ç‰ˆæœ¬å°†ä¼šï¼š
1. å°†â€œé€‰æ‹©å›½å®¶/åœ°åŒºâ€æ”¹ä¸ºä¸‹æ‹‰å¼é€‰å•ã€‚
2. æ›´æ–° UI æ–‡å­—ä»¥ç¬¦åˆæ–°éœ€æ±‚ã€‚
3. ä¿®æ”¹â€œå¼€å§‹æ‰­è›‹â€æŒ‰é’®çš„é€»è¾‘ï¼Œä½¿å…¶å‘¼å«é‡æ„åçš„ `/api/gacha/draw` APIã€‚
4. å»ºç«‹ä¸€ä¸ªç®€å•çš„åŒºåŸŸæ¥æ˜¾ç¤ºæ‰­è›‹ç»“æœã€‚
app/(tabs)/gacha.tsx çš„å®Œæ•´ç¨‹å¼ç 
code
TypeScript
import React, { useState } from 'react';
import { View, Text, StyleSheet, ScrollView, TouchableOpacity, ActivityIndicator, Alert } from 'react-native';
import { SafeAreaView } from 'react-native-safe-area-context';
// å‡è®¾ä½ çš„ UI å…ƒä»¶åº“åœ¨è¿™é‡Œï¼Œå¦‚æœæ²¡æœ‰ Select å…ƒä»¶ï¼Œå¯ä»¥æš‚æ—¶ç”¨æ–‡å­—ä»£æ›¿
// import { Select, SelectTrigger, SelectValue, SelectContent, SelectItem } from '../../src/components/ui/Select'; 
import { useApp } from '../../src/context/AppContext';
import { apiService } from '../../src/services/api'; // å‡è®¾ä½ çš„ apiService åœ¨è¿™é‡Œ
import { GachaResult } from '../../src/types'; // å‡è®¾ä½ çš„å‹åˆ«å®šä¹‰åœ¨è¿™é‡Œ

export default function GachaScreen() {
  const { user } = useApp().state; // è·å–ç”¨æˆ·ä¿¡æ¯
  const [selectedCountry, setSelectedCountry] = useState<string | null>(null);
  const [selectedCity, setSelectedCity] = useState<string | null>(null);
  const [drawCount, setDrawCount] = useState<number>(1);
  const [isLoading, setIsLoading] = useState(false);
  const [gachaResults, setGachaResults] = useState<GachaResult[]>([]);
  
  // æ¨¡æ‹Ÿçš„ä¸‹æ‹‰é€‰å•èµ„æ–™ (æœªæ¥åº”ä» API è·å–)
  const countries = [{ id: 'tw', name: 'å°æ¹¾' }, { id: 'jp', name: 'æ—¥æœ¬' }];
  const cities = {
    tw: [{ id: 'tpe', name: 'å°åŒ—' }, { id: 'khh', name: 'é«˜é›„' }],
    jp: [{ id: 'tky', name: 'ä¸œäº¬' }, { id: 'osa', name: 'å¤§é˜ª' }],
  };

  const handleDrawGacha = async () => {
    if (!selectedCity) {
      Alert.alert('æé†’', 'è¯·å…ˆé€‰æ‹©è¦æ¢ç´¢çš„åŸå¸‚ï¼');
      return;
    }
    
    setIsLoading(true);
    setGachaResults([]); // æ¸…ç©ºä¸Šæ¬¡ç»“æœ

    try {
      // **æ ¸å¿ƒï¼šå‘¼å«é‡æ„åçš„åç«¯ API**
      const results = await apiService.drawGacha({
        cityId: selectedCity,
        count: drawCount,
      });
      
      setGachaResults(results);

      // æ£€æŸ¥æ˜¯å¦æœ‰ä¸­å¥–
      const drawnCoupons = results.filter(r => r.drawnCoupon).map(r => r.drawnCoupon.title);
      if (drawnCoupons.length > 0) {
          // TODO: åœ¨è¿™é‡Œè§¦å‘ä¸­å¥–åŠ¨ç”»
          Alert.alert('æ­å–œä¸­å¥–ï¼', `ä½ è·å¾—äº†ï¼š${drawnCoupons.join(', ')}`);
      }

    } catch (error) {
      console.error('Gacha draw failed:', error);
      Alert.alert('é”™è¯¯', 'æŠ½å–å¤±è´¥ï¼Œè¯·ç¨åå†è¯•ã€‚');
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <SafeAreaView style={styles.container}>
      <ScrollView contentContainerStyle={styles.content}>
        <Text style={styles.title}>ä»Šå¤©å»å“ªç©ï¼Ÿè€å¤©è¯´äº†ç®—</Text>
        
        {/* --- è®¾å®šåŒº --- */}
        <View style={styles.settingsBox}>
          {/* å›½å®¶é€‰æ‹© (ä¸‹æ‹‰é€‰å•) */}
          <Text style={styles.label}>é€‰æ‹©æ¢ç´¢å›½å®¶</Text>
          {/* TODO: è¿™é‡Œåº”æ›¿æ¢ä¸ºä½ ä¸“æ¡ˆä¸­çœŸæ­£çš„ Select å…ƒä»¶ */}
          <View style={styles.selectPlaceholder}>
              <Text>{countries.find(c => c.id === selectedCountry)?.name || 'è¯·é€‰æ‹©å›½å®¶'}</Text>
          </View>

          {/* åŸå¸‚é€‰æ‹© (ä¸‹æ‹‰é€‰å•) */}
          <Text style={styles.label}>é€‰æ‹©åŸå¸‚/åœ°åŒº</Text>
          {/* TODO: è¿™é‡Œåº”æ›¿æ¢ä¸ºä½ ä¸“æ¡ˆä¸­çœŸæ­£çš„ Select å…ƒä»¶ */}
          <View style={styles.selectPlaceholder}>
              <Text>{selectedCountry && cities[selectedCountry]?.find(c => c.id === selectedCity)?.name || 'è¯·é€‰æ‹©åŸå¸‚'}</Text>
          </View>
          
          {/* è¡Œç¨‹æ•°é‡ */}
          <View style={styles.drawCountContainer}>
            <Text style={styles.label}>è¡Œç¨‹æ•°é‡</Text>
            <View style={styles.stepper}>
              <TouchableOpacity onPress={() => setDrawCount(c => Math.max(1, c - 1))}><Text style={styles.stepperButton}>-</Text></TouchableOpacity>
              <Text style={styles.drawCountText}>{drawCount}</Text>
              <TouchableOpacity onPress={() => setDrawCount(c => Math.min(10, c + 1))}><Text style={styles.stepperButton}>+</Text></TouchableOpacity>
            </View>
          </View>
          
          <TouchableOpacity style={styles.prizePoolButton}>
            <Text style={styles.prizePoolButtonText}>æŸ¥çœ‹å¥–æ± </Text>
          </TouchableOpacity>
        </View>

        {/* --- å¼€å§‹æ‰­è›‹æŒ‰é’® --- */}
        <TouchableOpacity style={styles.drawButton} onPress={handleDrawGacha} disabled={isLoading}>
          {isLoading ? (
            <ActivityIndicator color="#fff" />
          ) : (
            <Text style={styles.drawButtonText}>å¼€å§‹æ‰­è›‹</Text>
          )}
        </TouchableOpacity>
        
        {/* --- ç»“æœæ˜¾ç¤ºåŒº --- */}
        {gachaResults.length > 0 && (
          <View style={styles.resultsContainer}>
            <Text style={styles.resultsTitle}>æ‰­è›‹ç»“æœ</Text>
            {gachaResults.map((result, index) => (
              <View key={index} style={styles.resultCard}>
                <Text style={styles.placeName}>{result.place.name}</Text>
                {result.drawnCoupon && (
                  <Text style={styles.couponText}>ğŸ‰ è·å¾—ä¼˜æƒ åˆ¸: {result.drawnCoupon.title}</Text>
                )}
              </View>
            ))}
          </View>
        )}
      </ScrollView>
    </SafeAreaView>
  );
}

// æ ·å¼è¡¨ (è¿™æ˜¯ä¸€ä¸ªåŸºç¡€ç‰ˆæœ¬ï¼Œè¯·æ ¹æ®ä½ çš„è®¾è®¡è°ƒæ•´)
const styles = StyleSheet.create({
    container: { flex: 1, backgroundColor: '#F0F4F8' },
    content: { padding: 20 },
    title: { fontSize: 24, fontWeight: 'bold', textAlign: 'center', marginBottom: 20, color: '#333' },
    settingsBox: { backgroundColor: 'white', borderRadius: 12, padding: 20, marginBottom: 20 },
    label: { fontSize: 16, color: '#666', marginBottom: 8 },
    selectPlaceholder: { borderWidth: 1, borderColor: '#ddd', borderRadius: 8, padding: 12, marginBottom: 16 },
    drawCountContainer: { flexDirection: 'row', justifyContent: 'space-between', alignItems: 'center', marginBottom: 16 },
    stepper: { flexDirection: 'row', alignItems: 'center' },
    stepperButton: { fontSize: 20, paddingHorizontal: 12, color: '#4A90E2' },
    drawCountText: { fontSize: 18, fontWeight: '600', marginHorizontal: 10 },
    prizePoolButton: { alignSelf: 'center', marginTop: 10 },
    prizePoolButtonText: { color: '#4A90E2', fontSize: 14 },
    drawButton: { backgroundColor: '#4A90E2', padding: 15, borderRadius: 12, alignItems: 'center' },
    drawButtonText: { color: 'white', fontSize: 18, fontWeight: 'bold' },
    resultsContainer: { marginTop: 30 },
    resultsTitle: { fontSize: 20, fontWeight: 'bold', marginBottom: 10 },
    resultCard: { backgroundColor: 'white', padding: 15, borderRadius: 8, marginBottom: 10 },
    placeName: { fontSize: 16, fontWeight: '500' },
    couponText: { color: 'green', marginTop: 5, fontWeight: 'bold' },
});